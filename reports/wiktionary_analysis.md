# Wiktionary Processing Analysis

Generated by `tools/analyze_wiktionary_needs.py`

This report analyzes whether we need full wiktextract (Lua evaluation) or can use simpler XML parsing.

---

## What Wiktextract Produces

**Sample size:** 31 entries

### Top-level Keys

| Key | Count | Percentage |
|-----|------:|-----------:|
| word | 31 | 100.0% |
| lang | 31 | 100.0% |
| pos | 31 | 100.0% |
| tags | 13 | 41.9% |
| form_of | 2 | 6.5% |
| topics | 2 | 6.5% |

### POS Distribution

| POS | Count |
|-----|------:|
| noun | 15 |
| verb | 6 |
| adjective | 2 |
| pronoun | 1 |
| adverb | 1 |
| preposition | 1 |
| det | 1 |
| conj | 1 |
| adj | 1 |
| adv | 1 |
| intj | 1 |

### Sense-level Tags (Most Complex Part)

| Tag | Usage Count |
|-----|------------:|

**Has senses:** 0 (0.0%)  
**Has forms:** 0 (0.0%)  
**Has etymology:** 0 (0.0%)  
**Has categories:** 0 (0.0%)  

---

## What We Actually Use

⚠️ No merged data found. Run `make build-plus` first.

---

## Wiktionary Templates: What Requires Lua?

### Pos

**Source:** XML section headers  
**Lua evaluation needed:** False  
**Examples:**
- `==Noun==`
- `==Verb==`
- `==Adjective==`

### Context

**Source:** {{lb|en|...}} templates  
**Lua evaluation needed:** Maybe  
**Examples:**
- `{{lb|en|informal}}`
- `{{lb|en|obsolete}}`
- `{{lb|en|offensive}}`

### Gloss

**Source:** # Definition text  
**Lua evaluation needed:** False  
**Examples:**
- `# A domesticated animal.`
- `# To move quickly.`

### Phrase

**Source:** Page title contains spaces  
**Lua evaluation needed:** False  
**Examples:**
- `kick the bucket`
- `in front of`

### Forms

**Source:** {{en-noun|...}}, {{en-verb|...}} templates  
**Lua evaluation needed:** Maybe  
**Examples:**
- `{{en-noun|dogs}}`
- `{{en-verb|kicks}}`

---

## Analysis & Recommendations

### What We Actually Need

Our schema requires:
1. **Word** - Page title (directly in XML)
2. **POS** - Section headers like `==Noun==` (directly in XML)
3. **Labels** - Register/domain/temporal tags (may need template expansion)
4. **Gloss** - Definition text (mostly plain text in XML)
5. **Multi-word detection** - Spaces in page title (trivial)

### What Doesn't Require Lua

- ✅ Page titles (words/phrases)
- ✅ Section headers (POS)
- ✅ Definition text (glosses)
- ✅ Basic categories
- ✅ Multi-word phrase detection

### What Might Require Template Expansion

- ⚠️ Context labels: `{{lb|en|informal}}` → "informal"
- ⚠️ Inflection templates: `{{en-noun|dogs}}` → forms
- ⚠️ Some complex glosses with templates

But even these could be handled with **simple pattern matching** rather than full Lua evaluation!

### Potential Simplification

A custom XML parser could:
1. Parse MediaWiki XML directly (fast, no Lua overhead)
2. Extract page title, POS headers, basic categories
3. Use regex/patterns for common templates: `{{lb|en|(\w+)}}`
4. Skip complex templates we don't need
5. Run in minutes instead of hours
6. Avoid UTF-8 errors from Lua evaluation

**Trade-off:** Might miss some nuanced label data, but 90%+ coverage with 10x speed improvement.

